<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta id="repository-name" content="github.com/joaodiogocosta/soil">
  <link href="css/style.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="js/doc.js"></script>
  <title>README - github.com/joaodiogocosta/soil</title>
</head>
<body>

<div id="types-list">
  <div id="search-box">
    <input type="search" id="search-input" placeholder="Search...">
  </div>

  <ul>
    <li class="current"><a href="index.html">README</a></li>
  </ul>

  <ul>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Persistence" data-name="persistence">
      <a href="Persistence.html">Persistence</a>
      
    </li>
  
  <li class="parent " data-id="github.com/joaodiogocosta/soil/Relational" data-name="relational">
      <a href="Relational.html">Relational</a>
      
        <ul>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Relational/ColumnDefinition" data-name="relational::columndefinition">
      <a href="Relational/ColumnDefinition.html">ColumnDefinition</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Relational/Config" data-name="relational::config">
      <a href="Relational/Config.html">Config</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Relational/Database" data-name="relational::database">
      <a href="Relational/Database.html">Database</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Relational/Dialects" data-name="relational::dialects">
      <a href="Relational/Dialects.html">Dialects</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Relational/IndexDefinition" data-name="relational::indexdefinition">
      <a href="Relational/IndexDefinition.html">IndexDefinition</a>
      
    </li>
  
  <li class="parent " data-id="github.com/joaodiogocosta/soil/Relational/Interface" data-name="relational::interface">
      <a href="Relational/Interface.html">Interface</a>
      
        <ul>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Relational/Interface/Schema" data-name="relational::interface::schema">
      <a href="Relational/Interface/Schema.html">Schema</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Relational/Migration" data-name="relational::migration">
      <a href="Relational/Migration.html">Migration</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Relational/Migrator" data-name="relational::migrator">
      <a href="Relational/Migrator.html">Migrator</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Relational/TableDefinition" data-name="relational::tabledefinition">
      <a href="Relational/TableDefinition.html">TableDefinition</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/joaodiogocosta/soil/Soil" data-name="soil">
      <a href="Soil.html">Soil</a>
      
        <ul>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Action" data-name="soil::action">
      <a href="Soil/Action.html">Action</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/App" data-name="soil::app">
      <a href="Soil/App.html">App</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Config" data-name="soil::config">
      <a href="Soil/Config.html">Config</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/ConfigDSL" data-name="soil::configdsl">
      <a href="Soil/ConfigDSL.html">ConfigDSL</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Handler" data-name="soil::handler">
      <a href="Soil/Handler.html">Handler</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/HooksDSL" data-name="soil::hooksdsl">
      <a href="Soil/HooksDSL.html">HooksDSL</a>
      
    </li>
  
  <li class="parent " data-id="github.com/joaodiogocosta/soil/Soil/Http" data-name="soil::http">
      <a href="Soil/Http.html">Http</a>
      
        <ul>
  
  <li class="parent " data-id="github.com/joaodiogocosta/soil/Soil/Http/BodyParams" data-name="soil::http::bodyparams">
      <a href="Soil/Http/BodyParams.html">BodyParams</a>
      
        <ul>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Http/BodyParams/BodyType" data-name="soil::http::bodyparams::bodytype">
      <a href="Soil/Http/BodyParams/BodyType.html">BodyType</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Http/ContentTypes" data-name="soil::http::contenttypes">
      <a href="Soil/Http/ContentTypes.html">ContentTypes</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Http/Context" data-name="soil::http::context">
      <a href="Soil/Http/Context.html">Context</a>
      
    </li>
  
  <li class="parent " data-id="github.com/joaodiogocosta/soil/Soil/Http/Handlers" data-name="soil::http::handlers">
      <a href="Soil/Http/Handlers.html">Handlers</a>
      
        <ul>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Http/Handlers/MainHandler" data-name="soil::http::handlers::mainhandler">
      <a href="Soil/Http/Handlers/MainHandler.html">MainHandler</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Http/Handlers/StaticFileHandler" data-name="soil::http::handlers::staticfilehandler">
      <a href="Soil/Http/Handlers/StaticFileHandler.html">StaticFileHandler</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Http/Method" data-name="soil::http::method">
      <a href="Soil/Http/Method.html">Method</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Http/Params" data-name="soil::http::params">
      <a href="Soil/Http/Params.html">Params</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Http/Request" data-name="soil::http::request">
      <a href="Soil/Http/Request.html">Request</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Http/Response" data-name="soil::http::response">
      <a href="Soil/Http/Response.html">Response</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Http/Scheme" data-name="soil::http::scheme">
      <a href="Soil/Http/Scheme.html">Scheme</a>
      
    </li>
  
  <li class="parent " data-id="github.com/joaodiogocosta/soil/Soil/Http/Status" data-name="soil::http::status">
      <a href="Soil/Http/Status.html">Status</a>
      
        <ul>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Http/Status/Found" data-name="soil::http::status::found">
      <a href="Soil/Http/Status/Found.html">Found</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Http/Status/NotFound" data-name="soil::http::status::notfound">
      <a href="Soil/Http/Status/NotFound.html">NotFound</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Http/Status/Ok" data-name="soil::http::status::ok">
      <a href="Soil/Http/Status/Ok.html">Ok</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Http/Status/SeeOther" data-name="soil::http::status::seeother">
      <a href="Soil/Http/Status/SeeOther.html">SeeOther</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/NilAction" data-name="soil::nilaction">
      <a href="Soil/NilAction.html">NilAction</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Route" data-name="soil::route">
      <a href="Soil/Route.html">Route</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Router" data-name="soil::router">
      <a href="Soil/Router.html">Router</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/RoutingDSL" data-name="soil::routingdsl">
      <a href="Soil/RoutingDSL.html">RoutingDSL</a>
      
    </li>
  
  <li class="parent " data-id="github.com/joaodiogocosta/soil/Soil/Spec" data-name="soil::spec">
      <a href="Soil/Spec.html">Spec</a>
      
        <ul>
  
  <li class="parent " data-id="github.com/joaodiogocosta/soil/Soil/Spec/Mocr" data-name="soil::spec::mocr">
      <a href="Soil/Spec/Mocr.html">Mocr</a>
      
        <ul>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Spec/Mocr/Double" data-name="soil::spec::mocr::double">
      <a href="Soil/Spec/Mocr/Double.html">Double</a>
      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Spec/Mocr/Spy" data-name="soil::spec::mocr::spy">
      <a href="Soil/Spec/Mocr/Spy.html">Spy</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/joaodiogocosta/soil/Soil/Spec/RouteHelpers" data-name="soil::spec::routehelpers">
      <a href="Soil/Spec/RouteHelpers.html">RouteHelpers</a>
      
        <ul>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Spec/RouteHelpers/ExampleApp" data-name="soil::spec::routehelpers::exampleapp">
      <a href="Soil/Spec/RouteHelpers/ExampleApp.html">ExampleApp</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/joaodiogocosta/soil/Soil/Templating" data-name="soil::templating">
      <a href="Soil/Templating.html">Templating</a>
      
        <ul>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Templating/Macros" data-name="soil::templating::macros">
      <a href="Soil/Templating/Macros.html">Macros</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/View" data-name="soil::view">
      <a href="Soil/View.html">View</a>
      
    </li>
  
  <li class="parent " data-id="github.com/joaodiogocosta/soil/Soil/Views" data-name="soil::views">
      <a href="Soil/Views.html">Views</a>
      
        <ul>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Soil/Views/View" data-name="soil::views::view">
      <a href="Soil/Views/View.html">View</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/joaodiogocosta/soil/Views" data-name="views">
      <a href="Views.html">Views</a>
      
    </li>
  
</ul>

</div>

<div id="main-content">
<h1>Soil</h1>

<p>Soil is a Web Framework written in Crystal optimized for productivity and extensibility.</p>

<p><a href="https://travis-ci.org/joaodiogocosta/soil" target="_blank"><img src="https://travis-ci.org/joaodiogocosta/soil.svg?branch=master" alt="Build Status"/></a></p>

<p>It is inspired by the most well known Ruby and Javascript web frameworks, inheriting the completeness of Ruby on Rails, the clarity and readability of ExpressJS and the simplicity of Sinatra.</p>

<h2>Current state</h2>

<p>Soil is still a work in progress with a lot of missing features, but it will be constantly updated until it reaches a stable version.</p>

<h2>Installation</h2>

<p>Add Soil to <code>shard.yml</code>:</p>

<pre><code class='language-yaml'>dependencies:
  soil:
    github: joaodiogocosta/soil
    branch: master</code></pre>

<p>And then run:</p>

<pre><code></code></pre>

<h2>Basic Example</h2>

<p>The following is a basic example that defines a <code>GET /posts</code> endpoint and responds with JSON.</p>

<pre><code class='language-crystal'><span class="c"># blog_app.cr</span>

<span class="k">class</span> <span class="t">BlogApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  get <span class="s">&quot;posts&quot;</span> <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    posts <span class="o">=</span> [...]
    res.json(posts)
  <span class="k">end</span>
<span class="k">end</span>

<span class="t">BlogApp</span>.<span class="k">new</span>.run</code></pre>

<p>And then run:</p>

<pre><code></code></pre>

<h2>Table of Contents</h2>

<ul><li><a href="#routes" target="_blank">Routes</a></li><ul><li><a href="#definition" target="_blank">Definition</a></li><li><a href="#handlers" target="_blank">Handlers</a></li><li><a href="#params" target="_blank">Params</a></li><li><a href="#response" target="_blank">Response</a></li><li><a href="#json" target="_blank">JSON</a></li><li><a href="#render-templates" target="_blank">Render Templates</a></li><li><a href="#inline-html" target="_blank">Inline HTML</a></li><li><a href="#text" target="_blank">Text</a></li><li><a href="#redirect" target="_blank">Redirect</a></li><li><a href="#hooks" target="_blank">Hooks</a></li><li><a href="#namespaces" target="_blank">Namespaces</a></li><li><a href="#nested-routes" target="_blank">Nested Routes</a></li></ul><li><a href="#views-and-layouts" target="_blank">Views and Layouts</a></li><li><a href="#static-files" target="_blank">Static Files</a></li><li><a href="#configuration" target="_blank">Configuration</a></li></ul>

<h2>Routes</h2>

<h3>Definition</h3>

<p>Defining routes is extremely easy.</p>

<p>First, define a class that acts as a routes container, such as a Controller does in other web frameworks, and then define an arbitrary amount of routes by using methods such as <code>get</code> and passing a block handler that accepts <code>req</code> (request) and <code>res</code> (response) as arguments.</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">BlogApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  get <span class="s">&quot;/&quot;</span> <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    <span class="c"># ...</span>
  <span class="k">end</span>

  post <span class="s">&quot;/&quot;</span> <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    <span class="c"># ...</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<h3>Handlers</h3>

<p>A Route accepts two different types of handlers, crystal's built-in <a href="https://crystal-lang.org/docs/syntax_and_semantics/literals/proc.html" target="_blank">Proc</a> and <a href="#action" target="_blank">Action</a>.</p>

<h4>Proc</h4>

<p>A <code>Proc</code> is the simplest handler. To use it, simply pass in a block that accepts <code>req</code> (request) and <code>res</code> (response) as arguments:</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">BlogApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  get <span class="s">&quot;/&quot;</span> <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    <span class="c"># ...</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<h4>Action</h4>

<p>An <code>Action</code> is a plain Crystal object that includes <code><a href="Soil/Action.html">Soil::Action</a></code>, which is a module that ensures a proper <code>call</code> method is implemented:</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">PostsIndexAction</span>
  <span class="k">include</span> <span class="t">Soil</span><span class="t">::</span><span class="t">Action</span>

  <span class="k">def</span> <span class="m">call</span>(req, res)
    posts <span class="o">=</span> [...]
    res.json(posts)
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="t">PostsApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  get <span class="s">&quot;/&quot;</span>, <span class="t">PostsIndexAction</span>.<span class="k">new</span>
<span class="k">end</span></code></pre>

<p>This is particularly useful for endpoints that incorporate a considerable amount of operations, such as an enpoint that creates a new User account:</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">CreateUserAction</span>
  <span class="k">include</span> <span class="t">Soil</span><span class="t">::</span><span class="t">Action</span>

  <span class="k">def</span> <span class="m">initialize</span>
    @email_sender <span class="o">=</span> <span class="t">EmailSender</span>.<span class="k">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="m">call</span>(req, res)
    user <span class="o">=</span> create_user(req.params[<span class="s">&quot;user&quot;</span>])

    <span class="k">if</span> user
      send_welcome_email(user)
      res.json(user)
    <span class="k">else</span>
      res.status_code <span class="o">=</span> <span class="n">400</span>
      res.json(<span class="s">&quot;message&quot;</span> => <span class="s">&quot;Could not create User&quot;</span>)
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">private</span> <span class="k">def</span> <span class="m">create_user</span>(attributes)
    <span class="t">User</span>.create(attributes)
  <span class="k">end</span>

  <span class="k">private</span> <span class="k">def</span> <span class="m">send_welcome_email</span>(user)
    @email_sender.send(<span class="n">:welcome_email</span>, user.email)
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>And then use it in a Route:</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">BlogApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  get <span class="s">&quot;/&quot;</span>, <span class="t">CreateUserAction</span>.<span class="k">new</span>
<span class="k">end</span></code></pre>

<h4>Multiple Handlers</h4>

<p>Routes can have multiple handlers. <code>Proc</code> and <code>Action</code> can be combined in arrays:</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">LogAction</span>
  <span class="k">include</span> <span class="t">Soil</span><span class="t">::</span><span class="t">Action</span>

  <span class="k">def</span> <span class="m">call</span>(req, res)
    <span class="c"># Log something to STDOUT</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="t">PostsIndexAction</span>
  <span class="k">include</span> <span class="t">Soil</span><span class="t">::</span><span class="t">Action</span>

  <span class="k">def</span> <span class="m">call</span>(req, res)
    posts <span class="o">=</span> [...]
    res.json(posts)
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="t">PostsApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  get <span class="s">&quot;/&quot;</span>, [
    <span class="t">LogAction</span>.<span class="k">new</span>,
    <span class="t">PostsIndexAction</span>.<span class="k">new</span>,
    -> (req : <span class="t">Soil</span><span class="t">::</span><span class="t">Http</span><span class="t">::</span><span class="t">Request</span>, res : <span class="t">Soil</span><span class="t">::</span><span class="t">Http</span><span class="t">::</span><span class="t">Response</span>) {
      <span class="c"># ...</span>
    }]
<span class="k">end</span></code></pre>

<h3>Params</h3>

<h4>URL</h4>

<p>URL named parameters are captured and accessible via <code>req.params.url</code>:</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">BlogApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  get <span class="s">&quot;/posts/:post_id/comments/:comment_id&quot;</span> <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    req.params.url[<span class="s">&quot;post_id&quot;</span>] <span class="c"># &#61;&gt; &quot;45&quot;</span>
    req.params.url[<span class="s">&quot;comment_id&quot;</span>] <span class="c"># &#61;&gt; &quot;87&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<h4>Query</h4>

<p>Query parameters are accessible via <code>req.params.query</code>:</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">BlogApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  get <span class="s">&quot;/posts?search&#61;crystal&quot;</span> <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    req.params.query[<span class="s">&quot;search&quot;</span>] <span class="c"># &#61;&gt; &quot;crystal&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<h4>JSON</h4>

<p>JSON parameters are captured from the body and accessible via <code>req.params.json</code>.</p>

<p>Given the following JSON payload:</p>

<pre><code class='language-json'>{
  "post": {
    "title": "Soil is pure awesomeness!"
  }
}</code></pre>

<p>Here's how you would access its values:</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">BlogApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  post <span class="s">&quot;/posts&quot;</span> <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    req.params.json[<span class="s">&quot;post&quot;</span>][<span class="s">&quot;title&quot;</span>] <span class="c"># &#61;&gt; &quot;Soil is pure awesomeness&#33;&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<h3>Response</h3>

<h4>JSON</h4>

<p>Soil has built-in support for JSON responses. The following will call <code>to_json</code> on the object passed in as argument and write to the response body.</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">Api</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  get <span class="s">&quot;posts&quot;</span> <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    posts <span class="o">=</span> [...]
    res.json(posts)
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>This method will set the <code>Content-Type</code> header to <code>application/json</code>.</p>

<h4>Render Templates</h4>

<p>Render any template (HTML or others) by calling <code>render</code> on the response object and passing any <code>View</code> class. Read more about views <a href="#views-and-layouts" target="_blank">here</a>.</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">MyApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  get <span class="s">&quot;/&quot;</span> <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    res.render(<span class="t">IndexView</span>)
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>This method will set the <code>Content-Type</code> header to <code>text/html</code>.</p>

<h4>Inline HTML</h4>

<p>For inline HTML:</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">HtmlApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  get <span class="s">&quot;/&quot;</span> <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    res.html(<span class="s">&quot;&lt;html&gt;&lt;/html&gt;&quot;</span>)
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>This method will set the <code>Content-Type</code> header to <code>text/html</code>.</p>

<h4>Text</h4>

<p>For simple plain text responses:</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">TextApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  get <span class="s">&quot;/&quot;</span> <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    res.text(<span class="s">&quot;Soil says hi&#33;&quot;</span>)
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>This method will set the <code>Content-Type</code> header to <code>text/plain</code>.</p>

<h4>Redirect</h4>

<p>Use <code>redirect</code> to redirect the request to another path or url:</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">TextApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  get <span class="s">&quot;/&quot;</span> <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    res.redirect(<span class="s">&quot;/login&quot;</span>)

    <span class="c"># or</span>

    res.redirect(<span class="s">&quot;http://google.pt&quot;</span>)
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>This method will set the status code to <code>302</code> or <code>303</code> for <code>GET</code> and <code>POST</code> requests, respectively.</p>

<h3>Hooks</h3>

<p>Hooks are evaluated before or after each request within the same context of the request. They run before/after every request defined within the App or within mounted Apps.</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">Posts</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>

  before <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    pp req.params <span class="c"># print params before handler</span>
  <span class="k">end</span>

  after <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    pp res.status_code <span class="c"># print status code after handler</span>
  <span class="k">end</span>

  <span class="c"># ...</span>
<span class="k">end</span></code></pre>

<h3>Namespaces</h3>

<p>The following wil prepend <code>blog</code> to all routes, hence <code>/blog/posts</code>:</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">BlogApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  namespace <span class="s">&quot;blog&quot;</span>

  get <span class="s">&quot;posts&quot;</span> <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    posts <span class="o">=</span> [...]
    res.json(posts)
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>Namespaces are propagated to all routes.</p>

<h3>Nested Routes</h3>

<p>Nested Routes are the foundation of Soil's extensibility features.</p>

<p>Soil Apps can be combined to create complex applications of multiple endpoints with multiple levels of nesting.</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">Users</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  get <span class="s">&quot;/&quot;</span> <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    users <span class="o">=</span> [...]
    res.json(users)
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="t">Comments</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  get <span class="s">&quot;/&quot;</span> <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    <span class="c"># ...</span>
    req.params[<span class="s">&quot;post_id&quot;</span>] => <span class="c"># 231</span>
    <span class="c"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="t">Posts</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  mount <span class="s">&quot;:post_id/comments&quot;</span>, <span class="t">CommentsApp</span>

  get <span class="s">&quot;/&quot;</span> <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    posts <span class="o">=</span> [...]
    res.json(posts)
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="t">BlogApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  namespace <span class="s">&quot;blog&quot;</span>

  mount <span class="s">&quot;/users&quot;</span>, <span class="t">UsersApp</span>
  mount <span class="s">&quot;/posts&quot;</span>, <span class="t">PostsApp</span>
<span class="k">end</span></code></pre>

<p>This will generate the following routes:</p>

<p><code>GET /blog/users</code></p>

<p><code>GET /blog/posts</code></p>

<p><code>GET /blog/posts/:post_id/comments</code></p>

<h2>Views and Layouts</h2>

<p>Views and templating engines are a crucial part of every web framework. Soil's approach is to provide enough flexibility to the developer while enforcing good practices, such as having a reasonably well-defined data structure.</p>

<h3>The easy way, ideal for simple templates</h3>

<p>Soil has a built-in helper to render templates. It is available in regular routes and also in any Action subclasses.</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">MyApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  get <span class="s">&quot;/&quot;</span> <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    render_template res, <span class="s">&quot;index.html.ecr&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>Then create a new file which is the actual template. Soil uses Crystal's built-in templating engine <a href="https://crystal-lang.org/api/ECR.html" target="_blank">ECR</a>:</p>

<pre><code class='language-html'>(index.html.ecr)

&lt;p>I Love &lt;%= name %>!&lt;/p></code></pre>

<h3>The preferred way, ideal for templates with dynamic data</h3>

<p>Declare a new class that will act as the data container for the view template:</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">IndexView</span>
  <span class="k">include</span> <span class="t">Soil</span><span class="t">::</span><span class="t">View</span>

  <span class="k">def</span> <span class="m">initialize</span>(data)
    @name <span class="o">=</span> data[<span class="s">&quot;name&quot;</span>]
  <span class="k">end</span>

  <span class="k">def</span> <span class="m">name</span>
    @name
  <span class="k">end</span>

  <span class="k">def</span> <span class="m">render</span>(io : <span class="t">IO</span>)
    render_template io, <span class="s">&quot;index.html.ecr&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>It's mandatory to implement a <code>render(io : IO)</code> method. You can return whatever you want, in this case we will return a pre-compiled template.</p>

<p>Views are plain Crystal objects, you are free to implement them as you find more suitable to your needs, just remember to make publicly accessible the methods that are used in the template (<code>name</code> in this case).</p>

<p>Ultimately, reference it in your request handler by calling <code>render</code> just like any <code>text</code> or <code>JSON</code> response:</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">MyApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  get <span class="s">&quot;/&quot;</span> <span class="k">do</span> <span class="o">|</span>req, res<span class="o">|</span>
    res.render(<span class="t">IndexView</span>, { <span class="s">&quot;name&quot;</span> => <span class="s">&quot;Crystal&quot;</span> })
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>The result will be:</p>

<pre><code><span class="o"><</span>p<span class="o">></span><span class="t">I</span> love <span class="t">Crystal</span><span class="o">!</span><span class="o"><</span>p<span class="o">></span></code></pre>

<h3>Layouts</h3>

<p>Soil supports View Layouts.</p>

<p>Given a layout template, add the placeholder <code>yield_contents</code> to where you want to render a nested template:</p>

<pre><code class='language-html'>(layout.html.ecr)

&lt;div>
  &lt;%= yield_contents %>
&lt;/div></code></pre>

<p>And then reference this file in the View:</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">IndexView</span>
  <span class="k">include</span> <span class="t">Soil</span><span class="t">::</span><span class="t">View</span>

  <span class="k">def</span> <span class="m">render</span>(io : <span class="t">IO</span>)
    render_template io, <span class="s">&quot;index.html.ecr&quot;</span>, layout: <span class="s">&quot;layout.html.ecr&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>The contents of <code>index.html.ecr</code> will replace <code><%= yield_contents %></code> in the layout.</p>

<h2>Static Files</h2>

<p>To serve static files just enable the following configuration option:</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">MyApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  configure <span class="k">do</span> <span class="o">|</span>config<span class="o">|</span>
    config.serve_static_files <span class="o">=</span> <span class="n">true</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>This will serve files inside <code>public/</code>.</p>

<p>If you want to change the public directory from which the files are served, use the configuration option <code>public_dir</code>:</p>

<pre><code class='language-crystal'>config.public_dir <span class="o">=</span> <span class="s">&quot;custom_dir&quot;</span><span class="s">&#96;</code></pre>

<h2>Configuration</h2>

<p>As of now, Soil accepts configuration options for the following parameters:</p>

<pre><code class='language-crystal'><span class="k">class</span> <span class="t">BlogApp</span> <span class="o"><</span> <span class="t">Soil</span><span class="t">::</span><span class="t">App</span>
  configure <span class="k">do</span> <span class="o">|</span>config<span class="o">|</span>
    <span class="c"># Binding</span>
    config.host <span class="o">=</span> <span class="s">&quot;127.0.0.1&quot;</span>
    config.port <span class="o">=</span> <span class="s">&quot;4000&quot;</span>

    <span class="c"># Static Files</span>
    config.serve_static_files <span class="o">=</span> <span class="n">false</span>
    config.public_dir <span class="o">=</span> <span class="s">&quot;public&quot;</span>
  <span class="k">end</span>

  <span class="c"># ...</span>
<span class="k">end</span></code></pre>

<h2>Requirements</h2>

<p>Crystal - Please refer to http://crystal-lang.org/docs/installation for instructions for your operating system.</p>

<h2>Contributing</h2>

<p>Everyone is invited to make Soil a better project:</p>

<ol><li>Fork it ( https://github.com/joaodiogocosta/soil/fork )</li><li>Create your feature branch (git checkout -b my-new-feature)</li><li>Commit your changes (git commit -am 'Add some feature')</li><li>Push to the branch (git push origin my-new-feature)</li><li>Create a new Pull Request</li></ol>

<h2>License</h2>

<p>MIT License</p>

<p>Copyright (c) 2017 Jo√£o Diogo Costa</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
</div>
</body>
</html>
